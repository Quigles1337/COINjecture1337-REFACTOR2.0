<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="updated" content="1761462000-v3.15.0">
    <meta name="version" content="3.15.0">
    <meta name="cache-buster" content="1761462000-v3.15.0">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>COINjecture Mining - $BEANS</title>
        <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="data:,">
    
    <!-- @noble/ed25519 library for cryptographic wallet functionality -->
    <script>
        // Try multiple CDN sources with different versions
        function loadEd25519Library() {
            // First check if Web Crypto API is available
            if (window.crypto && window.crypto.subtle) {
                console.log('Web Crypto API available - using as primary Ed25519 source');
                window.ed25519Fallback = 'webcrypto';
                return;
            }
            
            const cdnSources = [
                {
                    url: 'https://cdn.jsdelivr.net/npm/@noble/ed25519@1.7.3/dist/index.js',
                    name: 'jsDelivr v1.7.3'
                },
                {
                    url: 'https://unpkg.com/@noble/ed25519@1.7.3/dist/index.js',
                    name: 'unpkg v1.7.3'
                },
                {
                    url: 'https://cdn.jsdelivr.net/npm/@noble/ed25519@1.7.1/dist/index.js',
                    name: 'jsDelivr v1.7.1'
                },
                {
                    url: 'https://unpkg.com/@noble/ed25519@1.7.1/dist/index.js',
                    name: 'unpkg v1.7.1'
                }
            ];
            
            let currentIndex = 0;
            
            function tryNextSource() {
                if (currentIndex >= cdnSources.length) {
                    console.error('All Ed25519 CDN sources failed - using Web Crypto API fallback');
                    // Try Web Crypto API as final fallback
                    if (window.crypto && window.crypto.subtle) {
                        console.log('Using Web Crypto API for Ed25519 operations');
                        window.ed25519Fallback = 'webcrypto';
                    } else {
                        console.log('Using demo wallets - no cryptographic support available');
                        window.ed25519Fallback = 'demo';
                    }
                    return;
                }
                
                const source = cdnSources[currentIndex];
                console.log(`Trying Ed25519 from ${source.name}...`);
                
                const script = document.createElement('script');
                script.src = source.url;
                script.onload = function() {
                    console.log(`Ed25519 library loaded successfully from ${source.name}`);
                    // Check for various ways the library might be exposed
                    if (window.nobleEd25519) {
                        console.log('Ed25519 library is ready (nobleEd25519)');
                    } else if (window.noble && window.noble.ed25519) {
                        window.nobleEd25519 = window.noble.ed25519;
                        console.log('Ed25519 library is ready (noble.ed25519)');
                    } else if (window.ed25519) {
                        window.nobleEd25519 = window.ed25519;
                        console.log('Ed25519 library is ready (ed25519)');
                    } else {
                        console.warn('Ed25519 library loaded but not accessible');
                        currentIndex++;
                        tryNextSource();
                    }
                };
                script.onerror = function() {
                    console.warn(`${source.name} failed, trying next source...`);
                    currentIndex++;
                    tryNextSource();
                };
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        // Load the library when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadEd25519Library);
        } else {
            loadEd25519Library();
        }
    </script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="brand-text">COINjecture</span>
                <span class="brand-subtitle">Mining Interface</span>
                <span class="brand-ticker">$BEANS</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Terminal</a>
                <a href="/mining" class="nav-link active">Mining</a>
                <a href="/metrics" class="nav-link">Metrics</a>
                <a href="/explorer" class="nav-link">Explorer</a>
                <a href="/download" class="nav-link">Download</a>
                <a href="/proof" class="nav-link">Proof</a>
                <a href="/api-docs" class="nav-link">API</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Mining Interface -->
        <div class="mining-container">
            <div class="mining-header">
                <h1>‚õèÔ∏è COINjecture Mining Interface</h1>
                <p class="mining-subtitle">Mobile-optimized subset sum problem solving for $BEANS rewards</p>
            </div>

            <!-- Wallet Section -->
            <div class="wallet-section">
                <div class="wallet-card">
                    <h2>üîê Wallet Management</h2>
                    <div class="wallet-controls">
                        <button id="create-wallet-btn" class="btn-primary">Create New Wallet</button>
                        <button id="load-wallet-btn" class="btn-secondary">Load Existing Wallet</button>
                    </div>
                    <div id="wallet-info" class="wallet-info" style="display: none;">
                        <div class="wallet-address">
                            <span class="label">Address:</span>
                            <span id="wallet-address" class="value"></span>
                            <button id="copy-address-btn" class="copy-btn" title="Copy Address">üìã</button>
                        </div>
                        <div class="wallet-balance">
                            <span class="label">Balance:</span>
                            <span id="wallet-balance" class="value">0 BEANS</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mining Controls -->
            <div class="mining-controls">
                <div class="mining-card">
                    <h2>üöÄ Mining Controls</h2>
                    <div class="mining-settings">
                        <div class="setting-group">
                            <label for="max-attempts">Max Attempts:</label>
                            <input type="number" id="max-attempts" value="100" min="1" max="1000">
                        </div>
                        <div class="setting-group">
                            <label for="auto-mining">Auto Mining:</label>
                            <input type="checkbox" id="auto-mining" checked>
                        </div>
                    </div>
                    <div class="mining-buttons">
                        <button id="start-mining-btn" class="btn-mining" disabled>Start Mining</button>
                        <button id="stop-mining-btn" class="btn-stop" disabled>Stop Mining</button>
                        <button id="test-mining-btn" class="btn-test">Test Setup</button>
                    </div>
                </div>
            </div>

            <!-- Current Problem -->
            <div class="problem-section">
                <div class="problem-card">
                    <h2>üßÆ Current Problem</h2>
                    <div id="problem-display" class="problem-display">
                        <p class="no-problem">No problem generated yet. Click "Start Mining" to begin.</p>
                    </div>
                    <div class="problem-controls">
                        <button id="generate-problem-btn" class="btn-secondary">Generate New Problem</button>
                        <button id="solve-problem-btn" class="btn-primary" disabled>Solve Problem</button>
                    </div>
                </div>
            </div>

            <!-- Mining Statistics -->
            <div class="stats-section">
                <div class="stats-card">
                    <h2>üìä Mining Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Status:</span>
                            <span id="mining-status" class="stat-value">Stopped</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Attempts:</span>
                            <span id="mining-attempts" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Successes:</span>
                            <span id="mining-successes" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Success Rate:</span>
                            <span id="mining-success-rate" class="stat-value">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Hash Rate:</span>
                            <span id="mining-hash-rate" class="stat-value">0 H/s</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Work Score:</span>
                            <span id="mining-work-score" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Duration:</span>
                            <span id="mining-duration" class="stat-value">0s</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Device:</span>
                            <span id="mining-device" class="stat-value">Unknown</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mining Log -->
            <div class="log-section">
                <div class="log-card">
                    <h2>üìã Mining Log</h2>
                    <div class="log-controls">
                        <button id="clear-log-btn" class="btn-secondary">Clear Log</button>
                        <button id="export-log-btn" class="btn-secondary">Export Log</button>
                    </div>
                    <div id="mining-log" class="mining-log">
                        <div class="log-entry info">
                            <span class="log-time">[00:00:00]</span>
                            <span class="log-message">Mining interface ready. Create or load a wallet to begin.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script type="module" src="./js/mining/mining-interface.js?v=3.15.0&t=1761462000"></script>
</body>
</html>
