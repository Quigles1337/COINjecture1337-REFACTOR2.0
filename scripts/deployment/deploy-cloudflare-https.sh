#!/usr/bin/env bash
set -euo pipefail

echo "ğŸš€ COINjecture Cloudflare HTTPS Deployment"
echo "=========================================="
echo ""

# Get S3 bucket IP address
echo "ğŸ” Getting S3 bucket IP address..."
S3_IP=$(nslookup coinjecture.com.s3-website.us-east-1.amazonaws.com | grep "Address:" | tail -1 | awk '{print $2}')
echo "   S3 IP: $S3_IP"
echo ""

echo "ğŸ“‹ Cloudflare Setup Instructions:"
echo ""
echo "1. ğŸŒ Go to https://cloudflare.com and sign up (free)"
echo "2. â• Click 'Add a Site' and enter: coinjecture.com"
echo "3. ğŸ†“ Choose 'Free' plan"
echo "4. ğŸ”„ Update nameservers at your domain registrar:"
echo "   (Cloudflare will show you 2 nameservers to use)"
echo ""
echo "5. ğŸ“ Add these DNS records in Cloudflare:"
echo ""
echo "   Type: A"
echo "   Name: @"
echo "   Content: $S3_IP"
echo "   Proxy Status: ğŸŸ  Proxied (ON)"
echo ""
echo "   Type: CNAME"
echo "   Name: www"
echo "   Content: coinjecture.com"
echo "   Proxy Status: ğŸŸ  Proxied (ON)"
echo ""
echo "6. ğŸ” Enable SSL/TLS settings:"
echo "   - Go to SSL/TLS â†’ Overview"
echo "   - Set encryption mode to 'Flexible'"
echo "   - Go to SSL/TLS â†’ Edge Certificates"
echo "   - Enable 'Always Use HTTPS'"
echo "   - Enable 'Automatic HTTPS Rewrites'"
echo ""
echo "7. â³ Wait 5-30 minutes for DNS propagation"
echo ""
echo "8. ğŸ§ª Test HTTPS access:"
echo "   curl -I https://coinjecture.com"
echo "   curl -I https://www.coinjecture.com"
echo ""

echo "âœ… Expected Results:"
echo "   - https://coinjecture.com (secure)"
echo "   - https://www.coinjecture.com (secure)"
echo "   - Free SSL certificate"
echo "   - Global CDN for faster loading"
echo "   - DDoS protection"
echo ""

echo "â±ï¸  Total Time: ~5 minutes setup + 5-30 minutes DNS propagation"
echo ""
echo "ğŸ¯ This is the FASTEST and EASIEST method for HTTPS!"
echo "   (Much faster than AWS CloudFront which takes 30+ minutes)"
